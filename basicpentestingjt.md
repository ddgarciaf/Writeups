![Basic_Pentesing_JT](https://imgur.com/3gPaslt.png)

Hola!

En este artículo vamos a enfrentarnos a una máquina de la plataforma Try Hack Me. Esta disponible de manera gratuita.

Descripción: "This is a machine that allows you to practise web app hacking and privilege escalation".

Dificultad: 1

-----------------

El primer es conectarnos a la máquina y ejecutar el VPN.

Una vez hayamos configurado las conexiones empezaremos por hacer un escaneo de puertos de la IP de la víctima:

![1 Nmap Port Scan](https://imgur.com/qhVZU3F.png)

Mediante este comando haremos un escaneo de todos los puertos posibles y nos los ira mostrando en pantalla mediante los vaya descubriendo.

Ahora para obtener mas información de lo que hace cada puerto haremos un escaneo de los servicios y la versión que corre cada uno de estos puertos:

![2 Service detection](https://imgur.com/yd2Z7jE.png)

Como podemos observar, nos encontramos con el puerto 80 abierto. Por lo que lo mas posible es que haya una pagina web activa en esta máquina. Para obtener una breve enumeración de los datos de la web ejecutaremos el comando "whatweb":

![3 Web scanning](https://imgur.com/88b5ugu.png)

Podemos ver que la web esta bajo el servidor Apache, mas concretamente bajo la versión 2.4.18.

Vamos a adentrarnos en la web y ver el código fuente de la misma para ver si hay algo de interés:

![4 Html code of the main web](https://imgur.com/9bqlJcJ.png)

Como podemos ver la pagina esta bajo mantenimiento y en el código fuente solamente nos encontramos con una nota que el desarrollador dejo diciendo que miremos la sección "dev".

Comprobamos si existe http://10.10.148.186/dev. Al parecer no existe, pero para comprobar si hay algún subdominio utilizaremos la herramienta "wfuzz", que nos hará un ataque de fuerza bruta de directorios a la página de la víctima:

![5 Web fuzzing](https://imgur.com/CpFSsDQ.png)

Como podemos ver, el subdominio http://10.10.148.186/development nos da un código de respuesta 200 por lo que sabemos que ese directorio existe. Entremos a ver si hay algo de interés:

![6 Directory list](https://imgur.com/NNuEYt5.png)

Por lo visto tenemos acceso a directory listing y podemos ver dos archivos de texto "dev.txt" y "j.txt". Veamos que hay dentro de ellos:

![7 dev-txt](https://imgur.com/TZL8LNF.png)

![8 j-txt](https://imgur.com/LV3P7P8.png)

En el archivo dev.txt nos encontramos con una conversación entre el desarrollador y el dueño de la pagina. Lo único en claro que podemos sacar es que están usando una versión de Apache 2.5.12 y las iniciales de sus nombres: J y K.

En cambio el archivo j.txt es una nota que le dejo el desarrollador al dueño conforme su contraseña era realmente mala y que estaba expuesta a ataques de fuerza bruta.

Sabiendo esto tenemos que la contraseña de "J" puede ser vulnerada a un ataque de fuerza bruta. El problema es que al no saber nada mas que su inicial un ataque de este tipo podría tardarse meses en sacarnos las credenciales.

Es por eso que con la herramienta "enum4linux" vamos a intentar sacar los usuarios que tienen acceso a esta máquina:

![9 enumerating users](https://imgur.com/2wuZB6H.png)

¡Nos ha sacado los dos usuarios! Ahora sabemos que la inicial "K" pertenece al nombre de Kay y "J" a Jan.

Sabiendo esto, intentaremos hacer un ataque de fuerza bruta con "hydra" por el protocolo ssh para obtener conexión remota al servidor.

![10 bruteforce ssh attack](https://imgur.com/yIz1xlr.png)

Después de 5 minutos hemos logrado sacar las credenciales del usuario Jan, el cual tiene como contraseña "armando".

Ahora vamos a intentar a acceder remotamente a el servidor vía ssh con las credenciales obtenidas:

![11 connecting victim by ssh](https://imgur.com/Ajiz62O.png)

¡Estamos dentro! El problema es que tenemos los mínimos privilegios por lo que vamos a intentar buscar algún archivo que nos de información del otro usuario que conocemos "Kay".

![12 copying id_rsa to our machine](https://imgur.com/IGHdB5A.png)

Vemos que hay un directorio oculto llamado ssh y dentro tenemos un id_rsa. Lo que haremos será copiarnos este archivo a nuestro ordenador con scp. Examinando su contenido con el comando "cat" podemos ver que es una RSA PRIVATE KEY, lo que haremos será hacer un ataque de fuerza bruta al usuario kay con esa clave. Pero antes hemos de convertir esa clave a un formato en el que john la pueda leer. Para eso utilizaremos la herramienta "ssh2john":

![13 converting ssh2john](https://imgur.com/7oA6POj.png)

Y posteriormente realizaremos el ataque de fuerza bruta:

![14 bruteforcing ssh key with john](https://imgur.com/zPkASN9.png)

¡Et voila! Nos ha sacado la contraseña del usuario kay "beeswax" ahora solo nos quedaria acceder al servidor remotamente desde este usuario con la id_rsa key:

![15 connecting via ssh with user kay](https://imgur.com/8V3PMiT.png)

Una vez dentro buscaremos la flag en el sistema y ya habremos terminado:

![16 searching the flag](https://imgur.com/ii5PVEd.png)
